{
  "id": "T117",
  "title": "Coverage sprint 2: raise daemon/config coverage for auth + validation + edge cases",
  "priority": 3,
  "status": "done",
  "details": "Increase coverage in the areas that are easiest to break and hardest to diagnose remotely: config validation/merging and daemon HTTP handlers/middleware. Prioritize negative tests (bad inputs) and security invariants (auth required, no secret leaks).",
  "steps": [
    "Add unit tests for internal/config validation rules: control_listen/token requirements, allowlist parsing, wildcard bind safety, URL validation, and file-config merge precedence.",
    "Add daemon handler tests for error paths and invariants: unauthorized/forbidden responses, invalid JSON bodies, 404/405 behaviors, and that responses never echo auth tokens or secrets.",
    "Add tests around workspace lease waiting: deadline handling, renewal loops, and ensuring the wrong lease owner cannot release a lease (CAS by nonce).",
    "Add tests for `/v1/host` and `/v1/status` payload stability (fields and types) so remote clients can rely on them.",
    "Re-run `make coverage-audit` and record before/after for internal/config and internal/daemon."
  ],
  "tags": [
    "testing",
    "coverage",
    "daemon",
    "config",
    "security"
  ],
  "files": [
    "internal/config/config_test.go",
    "internal/daemon/api_errors_test.go",
    "internal/daemon/control_auth_test.go",
    "internal/daemon/job_orchestrator_test.go",
    "internal/daemon/workspace_lease_wait_test.go",
    "internal/daemon/api_host_test.go",
    "internal/daemon/api_status_test.go",
    "docs/testing.md"
  ],
  "depends_on": [
    "T113"
  ],
  "created_at": "2026-02-10T01:59:57Z",
  "updated_at": "2026-02-10T05:04:51Z"
}
